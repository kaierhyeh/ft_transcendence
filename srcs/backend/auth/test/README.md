# Auth Service Tests

é€™å€‹ç›®éŒ„åŒ…å«äº† Auth æœå‹™çš„æ‰€æœ‰æ¸¬è©¦æª”æ¡ˆã€‚

## æ¸¬è©¦æª”æ¡ˆèªªæ˜

### ğŸ§ª test-rsa.js
- **åŠŸèƒ½**: æ¸¬è©¦ RSA é‡‘é‘°å°å’Œ JWT ç°½å/é©—è­‰
- **åŸ·è¡Œ**: `node test/test-rsa.js`
- **ä¾è³´**: éœ€è¦ jsonwebtoken å¥—ä»¶
- **æ¸¬è©¦å…§å®¹**:
  - RSA é‡‘é‘°æ ¼å¼é©—è­‰
  - JWT ç”Ÿæˆå’Œé©—è­‰
  - å®‰å…¨æ€§æ¸¬è©¦ï¼ˆé˜²ç¯¡æ”¹ã€ç®—æ³•é©—è­‰ï¼‰

### ğŸŒ test-api.js  
- **åŠŸèƒ½**: æ¸¬è©¦ Auth API ç«¯é»
- **åŸ·è¡Œ**: `node test/test-api.js`
- **ä¾è³´**: Node.js 18+ (ä½¿ç”¨å…§å»º fetch)
- **å‰ç½®æ¢ä»¶**: Auth æœå‹™éœ€è¦æ­£åœ¨é‹è¡Œ
- **æ¸¬è©¦å…§å®¹**:
  - å¥åº·æª¢æŸ¥ç«¯é»
  - åŸºæœ¬ API å¯ç”¨æ€§

### ğŸ” test-jwt.js
- **åŠŸèƒ½**: åˆ†æ JWT token çµæ§‹
- **åŸ·è¡Œ**: `node test/test-jwt.js`  
- **ä¾è³´**: ç„¡ï¼ˆä½¿ç”¨ Node.js å…§å»ºåŠŸèƒ½ï¼‰
- **æ¸¬è©¦å…§å®¹**:
  - JWT header å’Œ payload è§£æ
  - é©—è­‰ RSA ç°½åæ ¼å¼
  - Key ID æª¢æŸ¥

### ğŸ” test-jwks.sh
- **åŠŸèƒ½**: JWKS æ•´åˆæ¸¬è©¦
- **åŸ·è¡Œ**: `./test/test-jwks.sh`
- **å‰ç½®æ¢ä»¶**: Auth æœå‹™éœ€è¦æ­£åœ¨é‹è¡Œ
- **æ¸¬è©¦å…§å®¹**:
  - JWKS ç«¯é»æ¸¬è©¦
  - å®Œæ•´èªè­‰æµç¨‹æ¸¬è©¦
  - JWT å’Œ JWKS æ•´åˆé©—è­‰

## å¿«é€ŸåŸ·è¡Œ

### åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
```bash
cd /home/kyeh/develop/srcs/backend/auth/test
./run-tests.sh
```

### åŸ·è¡Œç‰¹å®šæ¸¬è©¦
```bash
# å¾ auth ç›®éŒ„åŸ·è¡Œ
cd /home/kyeh/develop/srcs/backend/auth

# RSA æ¸¬è©¦
node test/test-rsa.js

# API æ¸¬è©¦ (éœ€è¦æœå‹™é‹è¡Œ)
node test/test-api.js

# JWT åˆ†æ
node test/test-jwt.js

# JWKS æ•´åˆæ¸¬è©¦ (éœ€è¦æœå‹™é‹è¡Œ)
./test/test-jwks.sh
```

## å‰ç½®æ¢ä»¶

### 1. å®‰è£ä¾è³´
```bash
npm install
```

### 2. å•Ÿå‹•æœå‹™ (ç”¨æ–¼ API å’Œ JWKS æ¸¬è©¦)
```bash
cd ../../..  # å›åˆ° srcs ç›®éŒ„
docker compose up -d backend-auth
```

### 3. ç¢ºèª RSA é‡‘é‘°å­˜åœ¨
æ¸¬è©¦æœƒè‡ªå‹•æª¢æŸ¥ `../keys/` ç›®éŒ„ä¸­çš„ï¼š
- `private.pem` - RSA ç§é‘°
- `public.pem` - RSA å…¬é‘°

## æ¸¬è©¦è¦†è“‹ç¯„åœ

âœ… **RSA åŠ å¯†ç³»çµ±**
- é‡‘é‘°æ ¼å¼é©—è­‰
- ç°½åå’Œé©—è­‰åŠŸèƒ½
- å®‰å…¨æ€§é˜²è­·

âœ… **JWT å¯¦ä½œ**  
- Token ç”Ÿæˆå’Œè§£æ
- ç®—æ³•é©—è­‰ (RS256)
- Key ID æ•´åˆ

âœ… **JWKS ç³»çµ±**
- æ¨™æº–ç«¯é»æ¸¬è©¦
- RFC 7517 ç›¸å®¹æ€§
- é‡‘é‘°ç™¼ä½ˆå’Œé©—è­‰

âœ… **API æ•´åˆ**
- å¥åº·æª¢æŸ¥
- èªè­‰æµç¨‹
- éŒ¯èª¤è™•ç†

## æ•…éšœæ’é™¤

### æ‰¾ä¸åˆ°æ¨¡çµ„éŒ¯èª¤
```bash
# å®‰è£ä¾è³´
npm install
```

### é€£ç·šéŒ¯èª¤
```bash
# ç¢ºèªæœå‹™é‹è¡Œ
docker compose ps backend-auth

# å•Ÿå‹•æœå‹™
docker compose up -d backend-auth
```

### é‡‘é‘°æª”æ¡ˆéŒ¯èª¤
```bash
# æª¢æŸ¥é‡‘é‘°æª”æ¡ˆ
ls -la ../keys/
```